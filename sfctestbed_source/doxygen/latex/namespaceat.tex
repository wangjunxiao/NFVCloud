\hypertarget{namespaceat}{}\section{at 命名空间参考}
\label{namespaceat}\index{at@{at}}


\subsection{详细描述}
rules;
\begin{DoxyItemize}
\item the \href{https://jakubpawlowicz.github.io/clean-css}{\tt web interface} gets an improved settings panel with \char`\"{}reset to defaults\char`\"{}, instant option changes, and settings being persisted across sessions.
\end{DoxyItemize}

\subsubsection*{Constructor options}

clean-\/css constructor accepts a hash as a parameter with the following options available\+:


\begin{DoxyItemize}
\item {\ttfamily compatibility} -\/ controls compatibility mode used; defaults to {\ttfamily ie10+}; see \href{#compatibility-modes}{\tt compatibility modes} for examples;
\item {\ttfamily fetch} -\/ controls a function for handling remote requests; see \href{#fetch-option}{\tt fetch option} for examples (since 4.\+1.\+0);
\item {\ttfamily format} -\/ controls output C\+SS formatting; defaults to {\ttfamily false}; see \href{#formatting-options}{\tt formatting options} for examples;
\item {\ttfamily inline} -\/ controls {\ttfamily @import} inlining rules; defaults to `\textquotesingle{}local'{\ttfamily ; see \mbox{[}inlining options\mbox{]}(\#inlining-\/options) for examples; $\ast$}inline\+Request{\ttfamily -\/ controls extra options for inlining remote}{\ttfamily rules, can be any of \mbox{[}H\+T\+T\+P(\+S) request options\mbox{]}(\href{https://nodejs.org/api/http.html#http_http_request_options_callback}{\tt https\+://nodejs.\+org/api/http.\+html\#http\+\_\+http\+\_\+request\+\_\+options\+\_\+callback}); $\ast$}inline\+Timeout{\ttfamily -\/ controls number of milliseconds after which inlining a remote}{\ttfamily fails; defaults to 5000; $\ast$}level{\ttfamily -\/ controls optimization level used; defaults to}1{\ttfamily ; see \mbox{[}optimization levels\mbox{]}(\#optimization-\/levels) for examples; $\ast$}rebase{\ttfamily -\/ controls \mbox{\hyperlink{namespace_u_r_l}{U\+RL}} rebasing; defaults to}true{\ttfamily ; $\ast$}rebase\+To{\ttfamily -\/ controls a directory to which all U\+R\+Ls are rebased, most likely the directory under which the output file will live; defaults to the current directory; $\ast$}return\+Promise{\ttfamily -\/ controls whether}minify{\ttfamily method returns a Promise object or not; defaults to}false{\ttfamily ; see \mbox{[}promise interface\mbox{]}(\#promise-\/interface) for examples; $\ast$}source\+Map{\ttfamily -\/ controls whether an output source map is built; defaults to}false{\ttfamily ; $\ast$}source\+Map\+Inline\+Sources{\ttfamily -\/ controls embedding sources inside a source map\textquotesingle{}s}sources\+Content\`{} field; defaults to false.
\end{DoxyItemize}

\subsubsection*{Compatibility modes}

There is a certain number of compatibility mode shortcuts, namely\+:


\begin{DoxyItemize}
\item `new Clean\+C\+SS(\{ compatibility\+: '$\ast$\textquotesingle{} \}){\ttfamily (default) -\/ Internet Explorer 10+ compatibility mode $\ast$}new Clean\+C\+SS(\{ compatibility\+: \textquotesingle{}ie9\textquotesingle{} \}){\ttfamily -\/ Internet Explorer 9+ compatibility mode $\ast$}new Clean\+C\+SS(\{ compatibility\+: \textquotesingle{}ie8\textquotesingle{} \}){\ttfamily -\/ Internet Explorer 8+ compatibility mode $\ast$}new Clean\+C\+SS(\{ compatibility\+: \textquotesingle{}ie7\textquotesingle{} \})\`{} -\/ Internet Explorer 7+ compatibility mode
\end{DoxyItemize}

Each of these modes is an alias to a \href{https://github.com/jakubpawlowicz/clean-css/blob/master/lib/options/compatibility.js}{\tt fine grained configuration}, with the following options available\+:

\`{}\`{}\`{}js new Clean\+C\+SS(\{ compatibility\+: \{ colors\+: \{ opacity\+: true // controls {\ttfamily rgba()} / {\ttfamily hsla()} color support \}, properties\+: \{ background\+Clip\+Merging\+: true, // controls background-\/clip merging into shorthand background\+Origin\+Merging\+: true, // controls background-\/origin merging into shorthand background\+Size\+Merging\+: true, // controls background-\/size merging into shorthand colors\+: true, // controls color optimizations ie\+Bang\+Hack\+: false, // controls keeping IE bang hack ie\+Filters\+: false, // controls keeping IE {\ttfamily filter} / {\ttfamily -\/ms-\/filter} ie\+Prefix\+Hack\+: false, // controls keeping IE prefix hack ie\+Suffix\+Hack\+: false, // controls keeping IE suffix hack merging\+: true, // controls property merging based on understandability shorter\+Length\+Units\+: false, // controls shortening pixel units into {\ttfamily pc}, {\ttfamily pt}, or {\ttfamily in} units space\+After\+Closing\+Brace\+: true, // controls keeping space after closing brace -\/ {\ttfamily url() no-\/repeat} into {\ttfamily url()no-\/repeat} url\+Quotes\+: false, // controls keeping quoting inside {\ttfamily url()} zero\+Units\+: true // controls removal of units {\ttfamily 0} value \}, selectors\+: \{ adjacent\+Space\+: false, // controls extra space before {\ttfamily nav} element ie7\+Hack\+: true, // controls removal of I\+E7 selector hacks, e.\+g. {\ttfamily $\ast$+html...} mergeable\+Pseudo\+Classes\+: \mbox{[}\textquotesingle{}\+:active\textquotesingle{}, ...\mbox{]}, // controls a whitelist of mergeable pseudo classes mergeable\+Pseudo\+Elements\+: \mbox{[}\textquotesingle{}\+::after\textquotesingle{}, ...\mbox{]}, // controls a whitelist of mergeable pseudo elements merge\+Limit\+: 8191, // controls maximum number of selectors in a single rule (since 4.\+1.\+0) multiple\+Pseudo\+Merging\+: true // controls merging of rules with multiple pseudo classes / elements (since 4.\+1.\+0) \}, units\+: \{ ch\+: true, // controls treating {\ttfamily ch} as a supported unit in\+: true, // controls treating {\ttfamily in} as a supported unit pc\+: true, // controls treating {\ttfamily pc} as a supported unit pt\+: true, // controls treating {\ttfamily pt} as a supported unit rem\+: true, // controls treating {\ttfamily rem} as a supported unit vh\+: true, // controls treating {\ttfamily vh} as a supported unit vm\+: true, // controls treating {\ttfamily vm} as a supported unit vmax\+: true, // controls treating {\ttfamily vmax} as a supported unit vmin\+: true // controls treating {\ttfamily vmin} as a supported unit \} \} \}) 
\begin{DoxyCode}
You can also use a string when setting a compatibility mode, e.g.

```js
new CleanCSS(\{
  compatibility: 'ie9,-properties.merging' // sets compatibility to IE9 mode with disabled property merging
\})
\end{DoxyCode}


\subsubsection*{Fetch option}

The {\ttfamily fetch} option accepts a function which handles remote resource fetching, e.\+g.


\begin{DoxyCode}
var request = require('request');
var source = '@import url(http://example.com/path/to/stylesheet.css);';
new CleanCSS(\{
  fetch: function (uri, inlineRequest, inlineTimeout, callback) \{
    request(uri, function (error, response, body) \{
      if (error) \{
        callback(error, null);
      \} else if (response && response.statusCode != 200) \{
        callback(response.statusCode, null);
      \} else \{
        callback(null, body);
      \}
    \});
  \}
\}).minify(source);
\end{DoxyCode}


This option provides a convenient way of overriding the default fetching logic if it doesn\textquotesingle{}t support a particular feature, say C\+O\+N\+N\+E\+CT proxies.

Unless given, the default \href{https://github.com/jakubpawlowicz/clean-css/blob/master/lib/reader/load-remote-resource.js}{\tt load\+Remote\+Resource} logic is used.

\subsubsection*{Formatting options}

By default output C\+SS is formatted without any whitespace unless a {\ttfamily format} option is given. First of all there are two shorthands\+:


\begin{DoxyCode}
new CleanCSS(\{
  format: 'beautify' // formats output in a really nice way
\})
\end{DoxyCode}


and


\begin{DoxyCode}
new CleanCSS(\{
  format: 'keep-breaks' // formats output the default way but adds line breaks for improved readability
\})
\end{DoxyCode}


however {\ttfamily format} option also accept a fine-\/grained set of options\+:

\`{}\`{}\`{}js new Clean\+C\+SS(\{ format\+: \{ breaks\+: \{ // controls where to insert breaks after\+At\+Rule\+: false, // controls if a line break comes after an at-\/rule; e.\+g. {\ttfamily @charset}; defaults to {\ttfamily false} after\+Block\+Begins\+: false, // controls if a line break comes after a block begins; e.\+g. {\ttfamily @media}; defaults to {\ttfamily false} after\+Block\+Ends\+: false, // controls if a line break comes after a block ends, defaults to {\ttfamily false} after\+Comment\+: false, // controls if a line break comes after a comment; defaults to {\ttfamily false} after\+Property\+: false, // controls if a line break comes after a property; defaults to {\ttfamily false} after\+Rule\+Begins\+: false, // controls if a line break comes after a rule begins; defaults to {\ttfamily false} after\+Rule\+Ends\+: false, // controls if a line break comes after a rule ends; defaults to {\ttfamily false} before\+Block\+Ends\+: false, // controls if a line break comes before a block ends; defaults to {\ttfamily false} between\+Selectors\+: false // controls if a line break comes between selectors; defaults to {\ttfamily false} \}, indent\+By\+: 0, // controls number of characters to indent with; defaults to {\ttfamily 0} indent\+With\+: \textquotesingle{}space\textquotesingle{}, // controls a character to indent with, can be `\textquotesingle{}space'{\ttfamily or}\textquotesingle{}tab\textquotesingle{}{\ttfamily ; defaults to}\textquotesingle{}space\textquotesingle{}\`{} spaces\+: \{ // controls where to insert spaces around\+Selector\+Relation\+: false, // controls if spaces come around selector relations; e.\+g. {\ttfamily div $>$ a}; defaults to {\ttfamily false} before\+Block\+Begins\+: false, // controls if a space comes before a block begins; e.\+g. {\ttfamily .block \{}; defaults to {\ttfamily false} before\+Value\+: false // controls if a space comes before a value; e.\+g. {\ttfamily width\+: 1rem}; defaults to {\ttfamily false} \}, wrap\+At\+: false // controls maximum line length; defaults to {\ttfamily false} \} \}) 
\begin{DoxyCode}
## Inlining options

`inline` option whitelists which `@import` rules will be processed, e.g.

```js
new CleanCSS(\{
  inline: ['local'] // default; enables local inlining only
\})
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS(\{
  inline: ['none'] // disables all inlining
\})
\end{DoxyCode}



\begin{DoxyCode}
// introduced in clean-css 4.1.0

new CleanCSS(\{
  inline: false // disables all inlining (alias to `['none']`)
\})
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS(\{
  inline: ['all'] // enables all inlining, same as ['local', 'remote']
\})
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS(\{
  inline: ['local', 'mydomain.example.com'] // enables local inlining plus given remote source
\})
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS(\{
  inline: ['local', 'remote', '!fonts.googleapis.com'] // enables all inlining but from given remote source
\})
\end{DoxyCode}


\subsubsection*{Optimization levels}

The {\ttfamily level} option can be either {\ttfamily 0}, {\ttfamily 1} (default), or {\ttfamily 2}, e.\+g.


\begin{DoxyCode}
new CleanCSS(\{
  level: 2
\})
\end{DoxyCode}


or a fine-\/grained configuration given via a hash.

Please note that level 1 optimization options are generally safe while level 2 optimizations should be safe for most users.

\paragraph*{Level 0 optimizations}

Level 0 optimizations simply means \char`\"{}no optimizations\char`\"{}. Use it when you\textquotesingle{}d like to inline imports and / or rebase U\+R\+Ls but skip everything else.

\paragraph*{Level 1 optimizations}

Level 1 optimizations (default) operate on single properties only, e.\+g. can remove units when not required, turn rgb colors to a shorter hex representation, remove comments, etc

Here is a full list of available options\+:

\`{}\`{}\`{}js new Clean\+C\+SS(\{ level\+: \{ 1\+: \{ cleanup\+Charsets\+: true, // controls {\ttfamily @charset} moving to the front of a stylesheet; defaults to {\ttfamily true} normalize\+Urls\+: true, // controls \mbox{\hyperlink{namespace_u_r_l}{U\+RL}} normalization; defaults to {\ttfamily true} optimize\+Background\+: true, // controls {\ttfamily background} property optimizations; defaults to {\ttfamily true} optimize\+Border\+Radius\+: true, // controls {\ttfamily border-\/radius} property optimizations; defaults to {\ttfamily true} optimize\+Filter\+: true, // controls {\ttfamily filter} property optimizations; defaults to {\ttfamily true} optimize\+Font\+: true, // controls {\ttfamily font} property optimizations; defaults to {\ttfamily true} optimize\+Font\+Weight\+: true, // controls {\ttfamily font-\/weight} property optimizations; defaults to {\ttfamily true} optimize\+Outline\+: true, // controls {\ttfamily outline} property optimizations; defaults to {\ttfamily true} remove\+Empty\+: true, // controls removing empty rules and nested blocks; defaults to {\ttfamily true} remove\+Negative\+Paddings\+: true, // controls removing negative paddings; defaults to {\ttfamily true} remove\+Quotes\+: true, // controls removing quotes when unnecessary; defaults to {\ttfamily true} remove\+Whitespace\+: true, // controls removing unused whitespace; defaults to {\ttfamily true} replace\+Multiple\+Zeros\+: true, // contols removing redundant zeros; defaults to {\ttfamily true} replace\+Time\+Units\+: true, // controls replacing time units with shorter values; defaults to {\ttfamily true} replace\+Zero\+Units\+: true, // controls replacing zero values with units; defaults to {\ttfamily true} rounding\+Precision\+: false, // rounds pixel values to {\ttfamily N} decimal places; {\ttfamily false} disables rounding; defaults to {\ttfamily false} selectors\+Sorting\+Method\+: \textquotesingle{}standard\textquotesingle{}, // denotes selector sorting method; can be `\textquotesingle{}natural'{\ttfamily or}\textquotesingle{}standard\textquotesingle{}{\ttfamily ,}\textquotesingle{}none\textquotesingle{}{\ttfamily , or false (the last two since 4.\+1.\+0); defaults to}\textquotesingle{}standard\textquotesingle{}` special\+Comments\+: \textquotesingle{}all', // denotes a number of /$\ast$! ... $\ast$/ comments preserved; defaults to {\ttfamily all} tidy\+At\+Rules\+: true, // controls at-\/rules (e.\+g. {\ttfamily @charset}, {\ttfamily @import}) optimizing; defaults to {\ttfamily true} tidy\+Block\+Scopes\+: true, // controls block scopes (e.\+g. {\ttfamily @media}) optimizing; defaults to {\ttfamily true} tidy\+Selectors\+: true, // controls selectors optimizing; defaults to {\ttfamily true}, transform\+: function () \{\} // defines a callback for fine-\/grained property optimization; defaults to no-\/op \} \} \}); \`{}\`{}\`{}

There is an {\ttfamily all} shortcut for toggling all options at the same time, e.\+g.

\`{}\`{}\`{}js new Clean\+C\+SS(\{ level\+: \{ 1\+: \{ all\+: false, // set all values to {\ttfamily false} tidy\+Selectors\+: true // turns on optimizing selectors \} \} \}); \`{}\`{}\`{}

\paragraph*{Level 2 optimizations}

Level 2 optimizations operate at rules or multiple properties level, e.\+g. can remove duplicate rules, remove properties redefined further down a stylesheet, or restructure rules by moving them around.

Please note that if level 2 optimizations are turned on then, unless explicitely disabled, level 1 optimizations are applied as well.

Here is a full list of available options\+:

\`{}\`{}\`{}js new Clean\+C\+SS(\{ level\+: \{ 2\+: \{ merge\+Adjacent\+Rules\+: true, // controls adjacent rules merging; defaults to true merge\+Into\+Shorthands\+: true, // controls merging properties into shorthands; defaults to true merge\+Media\+: true, // controls {\ttfamily @media} merging; defaults to true merge\+Non\+Adjacent\+Rules\+: true, // controls non-\/adjacent rule merging; defaults to true merge\+Semantically\+: false, // controls semantic merging; defaults to false override\+Properties\+: true, // controls property overriding based on understandability; defaults to true remove\+Empty\+: true, // controls removing empty rules and nested blocks; defaults to {\ttfamily true} reduce\+Non\+Adjacent\+Rules\+: true, // controls non-\/adjacent rule reducing; defaults to true remove\+Duplicate\+Font\+Rules\+: true, // controls duplicate {\ttfamily @font-\/face} removing; defaults to true remove\+Duplicate\+Media\+Blocks\+: true, // controls duplicate {\ttfamily @media} removing; defaults to true remove\+Duplicate\+Rules\+: true, // controls duplicate rules removing; defaults to true remove\+Unused\+At\+Rules\+: false, // controls unused at rule removing; defaults to false (available since 4.\+1.\+0) restructure\+Rules\+: false, // controls rule restructuring; defaults to false skip\+Properties\+: \mbox{[}\mbox{]} // controls which properties won\textquotesingle{}t be optimized, defaults to {\ttfamily \mbox{[}\mbox{]}} which means all will be optimized (since 4.\+1.\+0) \} \} \}); \`{}\`{}\`{}

There is an {\ttfamily all} shortcut for toggling all options at the same time, e.\+g.

\`{}\`{}\`{}js new Clean\+C\+SS(\{ level\+: \{ 2\+: \{ all\+: false, // sets all values to {\ttfamily false} remove\+Duplicate\+Rules\+: true // turns on removing duplicate rules \} \} \}); 
\begin{DoxyCode}
## Minify method

Once configured clean-css provides a `minify` method to optimize a given CSS, e.g.

```js
var output = new CleanCSS(options).minify(source);
\end{DoxyCode}


The output of the {\ttfamily minify} method is a hash with following fields\+:


\begin{DoxyCode}
console.log(output.styles); // optimized output CSS as a string
console.log(output.sourceMap); // output source map if requested with `sourceMap` option
console.log(output.errors); // a list of errors raised
console.log(output.warnings); // a list of warnings raised
console.log(output.stats.originalSize); // original content size after import inlining
console.log(output.stats.minifiedSize); // optimized content size
console.log(output.stats.timeSpent); // time spent on optimizations in milliseconds
console.log(output.stats.efficiency); // a ratio of output size to input size (e.g. 25% if content was
       reduced from 100 bytes to 75 bytes)
\end{DoxyCode}


The {\ttfamily minify} method also accepts an input source map, e.\+g.


\begin{DoxyCode}
var output = new CleanCSS(options).minify(source, inputSourceMap);
\end{DoxyCode}


or a callback invoked when optimizations are finished, e.\+g.


\begin{DoxyCode}
new CleanCSS(options).minify(source, function (error, output) \{
  // `output` is the same as in the synchronous call above
\});
\end{DoxyCode}


\subsubsection*{Promise interface}

If you prefer clean-\/css to return a Promise object then you need to explicitely ask for it, e.\+g.


\begin{DoxyCode}
new CleanCSS(\{ returnPromise: true \})
  .minify(source)
  .then(function (output) \{ console.log(output.styles); \})
  .catch(function (error) \{ // deal with errors \});
\end{DoxyCode}


\subsubsection*{C\+LI utility}

Clean-\/css has an associated command line utility that can be installed separately using {\ttfamily npm install clean-\/css-\/cli}. For more detailed information, please visit \href{https://github.com/jakubpawlowicz/clean-css-cli}{\tt https\+://github.\+com/jakubpawlowicz/clean-\/css-\/cli}.

\subsection*{F\+AQ}

\subsubsection*{How to optimize multiple files?}

It can be done either by passing an array of paths, or, when sources are already available, a hash or an array of hashes\+:


\begin{DoxyCode}
new CleanCSS().minify(['path/to/file/one', 'path/to/file/two']);
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS().minify(\{
  'path/to/file/one': \{
    styles: 'contents of file one'
  \},
  'path/to/file/two': \{
    styles: 'contents of file two'
  \}
\});
\end{DoxyCode}



\begin{DoxyCode}
new CleanCSS().minify([
  \{'path/to/file/one': \{styles: 'contents of file one'\}\},
  \{'path/to/file/two': \{styles: 'contents of file two'\}\}
]);
\end{DoxyCode}


Passing an array of hashes allows you to explicitly specify the order in which the input files are concatenated. Whereas when you use a single hash the order is determined by the \href{http://2ality.com/2015/10/property-traversal-order-es6.html}{\tt traversal order of object properties} -\/ available since 4.\+1.\+0.

Important note -\/ any {\ttfamily @import} rules already present in the hash will be resolved in memory.

\subsubsection*{How to process remote {\ttfamily @import}s correctly?}

In order to inline remote {\ttfamily @import} statements you need to provide a callback to minify method as fetching remote assets is an asynchronous operation, e.\+g.\+:


\begin{DoxyCode}
var source = '@import url(http://example.com/path/to/remote/styles);';
new CleanCSS(\{ inline: ['remote'] \}).minify(source, function (error, output) \{
  // output.styles
\});
\end{DoxyCode}


If you don\textquotesingle{}t provide a callback, then remote {\ttfamily @import}s will be left as is.

\subsubsection*{How to apply arbitrary transformations to C\+SS properties?}

If clean-\/css doesn\textquotesingle{}t perform a particular property optimization, you can use {\ttfamily transform} callback to apply it\+:


\begin{DoxyCode}
var source = '.block\{background-image:url(/path/to/image.png)\}';
var output = new CleanCSS(\{
  level: \{
    1: \{
      transform: function (propertyName, propertyValue) \{
        if (propertyName == 'background-image' && propertyValue.indexOf('/path/to') > -1) \{
          return propertyValue.replace('/path/to', '../valid/path/to');
        \}
      \}
    \}
  \}
\}).minify(source);

console.log(output.styles); # => .block\{background-image:url(../valid/path/to/image.png)\}
\end{DoxyCode}


Note\+: returning {\ttfamily false} from {\ttfamily transform} callback will drop a property.

\subsubsection*{How to specify a custom rounding precision?}

The level 1 {\ttfamily rounding\+Precision} optimization option accept a string with per-\/unit rounding precision settings, e.\+g.


\begin{DoxyCode}
new CleanCSS(\{
  level: \{
    1: \{
      roundingPrecision: 'all=3,px=5'
    \}
  \}
\}).minify(source)
\end{DoxyCode}


which sets all units rounding precision to 3 digits except {\ttfamily px} unit precision of 5 digits.

\subsubsection*{How to preserve a comment block?}

Use the {\ttfamily /$\ast$!} notation instead of the standard one {\ttfamily /$\ast$}\+:


\begin{DoxyCode}
/*!
  Important comments included in optimized output.
*/
\end{DoxyCode}


\subsubsection*{How to rebase relative image U\+R\+Ls?}

clean-\/css will handle it automatically for you in the following cases\+:


\begin{DoxyItemize}
\item when full paths to input files are passed in as options;
\item when correct paths are passed in via a hash;
\item when {\ttfamily rebase\+To} is used with any of above two.
\end{DoxyItemize}

\subsubsection*{How to work with source maps?}

To generate a source map, use {\ttfamily source\+Map\+: true} option, e.\+g.\+:


\begin{DoxyCode}
new CleanCSS(\{ sourceMap: true, rebaseTo: pathToOutputDirectory \})
  .minify(source, function (error, output) \{
    // access output.sourceMap for SourceMapGenerator object
    // see https://github.com/mozilla/source-map/#sourcemapgenerator for more details
\});
\end{DoxyCode}


You can also pass an input source map directly as a 2nd argument to {\ttfamily minify} method\+:


\begin{DoxyCode}
new CleanCSS(\{ sourceMap: true, rebaseTo: pathToOutputDirectory \})
  .minify(source, inputSourceMap, function (error, output) \{
    // access output.sourceMap to access SourceMapGenerator object
    // see https://github.com/mozilla/source-map/#sourcemapgenerator for more details
\});
\end{DoxyCode}


or even multiple input source maps at once\+:


\begin{DoxyCode}
new CleanCSS(\{ sourceMap: true, rebaseTo: pathToOutputDirectory \}).minify(\{
  'path/to/source/1': \{
    styles: '...styles...',
    sourceMap: '...source-map...'
  \},
  'path/to/source/2': \{
    styles: '...styles...',
    sourceMap: '...source-map...'
  \}
\}, function (error, output) \{
  // access output.sourceMap as above
\});
\end{DoxyCode}


\subsubsection*{How to apply level 1 \& 2 optimizations at the same time?}

Using the hash configuration specifying both optimization levels, e.\+g.


\begin{DoxyCode}
new CleanCSS(\{
  level: \{
    1: \{
      all: true,
      normalizeUrls: false
    \},
    2: \{
      restructureRules: true
    \}
  \}
\})
\end{DoxyCode}


will apply level 1 optimizations, except url normalization, and default level 2 optimizations with rule restructuring.

\subsubsection*{What level 2 optimizations do?}

All level 2 optimizations are dispatched \href{https://github.com/jakubpawlowicz/clean-css/blob/master/lib/optimizer/level-2/optimize.js#L67}{\tt here}, and this is what they do\+:


\begin{DoxyItemize}
\item {\ttfamily recursively\+Optimize\+Blocks} -\/ does all the following operations on a nested block, like {\ttfamily @media} or {\ttfamily @keyframe};
\item {\ttfamily recursively\+Optimize\+Properties} -\/ optimizes properties in rulesets and flat at-\/rules, like -\/face, by splitting them into components (e.\+g. {\ttfamily margin} into {\ttfamily margin-\/(bottom$\vert$left$\vert$right$\vert$top)}), optimizing, and restoring them back. You may want to use {\ttfamily merge\+Into\+Shorthands} option to control whether you want to turn multiple components into shorthands;
\item {\ttfamily remove\+Duplicates} -\/ gets rid of duplicate rulesets with exactly the same set of properties, e.\+g. when including a Sass / Less partial twice for no good reason;
\item {\ttfamily merge\+Adjacent} -\/ merges adjacent rulesets with the same selector or rules;
\item {\ttfamily reduce\+Non\+Adjacent} -\/ identifies which properties are overridden in same-\/selector non-\/adjacent rulesets, and removes them;
\item {\ttfamily merge\+Non\+Adjacent\+By\+Selector} -\/ identifies same-\/selector non-\/adjacent rulesets which can be moved (!) to be merged, requires all intermediate rulesets to not redefine the moved properties, or if redefined to have the same value;
\item {\ttfamily merge\+Non\+Adjacent\+By\+Body} -\/ same as the one above but for same-\/selector non-\/adjacent rulesets;
\item {\ttfamily restructure} -\/ tries to reorganize different-\/selector different-\/rules rulesets so they take less space, e.\+g. {\ttfamily .one\{padding\+:0\}.two\{margin\+:0\}.one\{margin-\/bottom\+:3px\}} into {\ttfamily .two\{margin\+:0\}.one\{padding\+:0;margin-\/bottom\+:3px\}};
\item {\ttfamily remove\+Duplicate\+Font\+At\+Rules} -\/ removes duplicated {\ttfamily @font-\/face} rules;
\item {\ttfamily remove\+Duplicate\+Media\+Queries} -\/ removes duplicated {\ttfamily @media} nested blocks;
\item {\ttfamily merge\+Media\+Queries} -\/ merges non-\/adjacent {\ttfamily @media} at-\/rules by the same rules as {\ttfamily merge\+Non\+Adjacent\+By$\ast$} above;
\end{DoxyItemize}

\subsubsection*{How to use clean-\/css with build tools?}

There is a number of 3rd party plugins to popular build tools\+:


\begin{DoxyItemize}
\item \href{https://github.com/broccolijs/broccoli#broccoli}{\tt Broccoli}\+: \href{https://github.com/shinnn/broccoli-clean-css}{\tt broccoli-\/clean-\/css}
\item \href{http://brunch.io/}{\tt Brunch}\+: \href{https://github.com/brunch/clean-css-brunch}{\tt clean-\/css-\/brunch}
\item \href{http://gruntjs.com}{\tt Grunt}\+: \href{https://github.com/gruntjs/grunt-contrib-cssmin}{\tt grunt-\/contrib-\/cssmin}
\item \href{http://gulpjs.com/}{\tt Gulp}\+: \href{https://github.com/scniro/gulp-clean-css}{\tt gulp-\/clean-\/css}
\item \href{http://gulpjs.com/}{\tt Gulp}\+: \href{https://github.com/jakubpawlowicz/clean-css/issues/342}{\tt using vinyl-\/map as a wrapper -\/ courtesy of }
\item \href{https://github.com/component/builder2.js}{\tt component-\/builder2}\+: \href{https://github.com/poying/builder-clean-css}{\tt builder-\/clean-\/css}
\item \href{http://metalsmith.io}{\tt Metalsmith}\+: \href{https://github.com/aymericbeaumet/metalsmith-clean-css}{\tt metalsmith-\/clean-\/css}
\item \href{https://github.com/lasso-js/lasso}{\tt Lasso}\+: \href{https://github.com/yomed/lasso-clean-css}{\tt lasso-\/clean-\/css}
\item \href{https://github.com/start-runner/start}{\tt Start}\+: \href{https://github.com/start-runner/clean-css}{\tt start-\/clean-\/css}
\end{DoxyItemize}

\subsubsection*{How to use clean-\/css from web browser?}


\begin{DoxyItemize}
\item \href{https://jakubpawlowicz.github.io/clean-css/}{\tt https\+://jakubpawlowicz.\+github.\+io/clean-\/css/} (official web interface)
\item \href{http://refresh-sf.com/}{\tt http\+://refresh-\/sf.\+com/}
\item \href{http://adamburgess.github.io/clean-css-online/}{\tt http\+://adamburgess.\+github.\+io/clean-\/css-\/online/}
\end{DoxyItemize}

\subsection*{Contributing}

See https\+://github.com/jakubpawlowicz/clean-\/css/blob/master/\+C\+O\+N\+T\+R\+I\+B\+U\+T\+I\+N\+G.\+md \char`\"{}\+C\+O\+N\+T\+R\+I\+B\+U\+T\+I\+N\+G.\+md\char`\"{}.

\subsubsection*{How to get started?}

First clone the sources\+:


\begin{DoxyCode}
git clone git@github.com:jakubpawlowicz/clean-css.git
\end{DoxyCode}


then install dependencies\+:


\begin{DoxyCode}
cd clean-css
npm install
\end{DoxyCode}


then use any of the following commands to verify your copy\+:


\begin{DoxyCode}
npm run bench # for clean-css benchmarks (see
       [test/bench.js](https://github.com/jakubpawlowicz/clean-css/blob/master/test/bench.js) for details)
npm run browserify # to create the browser-ready clean-css version
npm run check # to lint JS sources with [JSHint](https://github.com/jshint/jshint/)
npm test # to run all tests
\end{DoxyCode}


\subsection*{Acknowledgments}

Sorted alphabetically by Git\+Hub handle\+:


\begin{DoxyItemize}
\item \href{https://github.com/abarre}{\tt } (Anthony Barre) for improvements to {\ttfamily @import} processing;
\item \href{https://github.com/alexlamsl}{\tt } (Alex Lam S.\+L.) for testing early clean-\/css 4 versions, reporting bugs, and suggesting numerous improvements.
\item \href{https://github.com/altschuler}{\tt } (Simon Altschuler) for fixing {\ttfamily @import} processing inside comments;
\item \href{https://github.com/ben-eb}{\tt -\/eb} (Ben Briggs) for sharing ideas about C\+SS optimizations;
\item \href{https://github.com/facelessuser}{\tt } (Isaac) for pointing out a flaw in clean-\/css\textquotesingle{} stateless mode;
\item \href{https://github.com/grandrath}{\tt } (Martin Grandrath) for improving {\ttfamily minify} method source traversal in E\+S6;
\item \href{https://github.com/jmalonzo}{\tt } (Jan Michael Alonzo) for a patch removing node.\+js\textquotesingle{} old {\ttfamily sys} package;
\item \href{https://github.com/lukeapage}{\tt } (Luke Page) for suggestions and testing the source maps feature; Plus everyone else involved in \href{https://github.com/jakubpawlowicz/clean-css/issues/125}{\tt \#125} for pushing it forward;
\item \href{https://github.com/madwizard-thomas}{\tt -\/thomas} for sharing ideas about {\ttfamily @import} inlining and \mbox{\hyperlink{namespace_u_r_l}{U\+RL}} rebasing.
\item \href{https://github.com/ngyikp}{\tt } (Ng Yik Phang) for testing early clean-\/css 4 versions, reporting bugs, and suggesting numerous improvements.
\item \href{https://github.com/wagenet}{\tt } (Peter Wagenet) for suggesting improvements to {\ttfamily @import} inlining behavior;
\item \href{https://github.com/venemo}{\tt } (Timur Kristóf) for an outstanding contribution of advanced property optimizer for 2.\+2 release;
\item \href{https://github.com/vvo}{\tt } (Vincent Voyer) for a patch with better empty element regex and for inspiring us to do many performance improvements in 0.\+4 release;
\item \href{https://github.com/xhmikosr}{\tt } for suggesting new features, like option to remove special comments and strip out U\+R\+Ls quotation, and pointing out numerous improvements like J\+S\+Hint, media queries, etc.
\end{DoxyItemize}

\subsection*{License}

clean-\/css is released under the \href{https://github.com/jakubpawlowicz/clean-css/blob/master/LICENSE}{\tt M\+IT License}. 