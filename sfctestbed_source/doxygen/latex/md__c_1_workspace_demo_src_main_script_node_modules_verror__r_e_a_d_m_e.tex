This module provides two classes\+: V\+Error, for accretive errors, and W\+Error, for wrapping errors. Both support printf-\/style error messages using extsprintf.

\subsection*{Printf-\/style errors}

At the most basic level, V\+Error is just like Java\+Script\textquotesingle{}s Error class, but with printf-\/style arguments\+: \begin{DoxyVerb}var verror = require('verror');

var opname = 'read';
var err = new verror.VError('"%s" operation failed', opname);
console.log(err.message);
console.log(err.stack);
\end{DoxyVerb}


This prints\+: \begin{DoxyVerb}"read" operation failed
"read" operation failed
    at Object.<anonymous> (/Users/dap/node-verror/examples/varargs.js:4:11)
    at Module._compile (module.js:449:26)
    at Object.Module._extensions..js (module.js:467:10)
    at Module.load (module.js:356:32)
    at Function.Module._load (module.js:312:12)
    at Module.runMain (module.js:492:10)
    at process.startup.processNextTick.process._tickCallback (node.js:244:9)
\end{DoxyVerb}


\subsection*{V\+Error for accretive error messages}

More interestingly, you can use V\+Error to build up an error describing what happened at various levels in the stack. For example, suppose you have a request handler that stats a file and fails if it doesn\textquotesingle{}t exist\+: \begin{DoxyVerb}var fs = require('fs');
var verror = require('verror');

function checkFile(filename, callback) {
    fs.stat(filename, function (err) {
        if (err)
    /* Annotate the "stat" error with what we were doing. */
        return (callback(new verror.VError(err,
        'failed to check "%s"', filename)));

    /* ... */
    });
}

function handleRequest(filename, callback) {
    checkFile('/nonexistent', function (err) {
        if (err) {
            /* Annotate the "checkFile" error with what we were doing. */
            return (callback(new verror.VError(err, 'request failed')));
        }

        /* ... */
    });
}

handleRequest('/nonexistent', function (err) {
if (err)
    console.log(err.message);
/* ... */
});
\end{DoxyVerb}


Since the file \char`\"{}/nonexistent\char`\"{} doesn\textquotesingle{}t exist, this prints out\+: \begin{DoxyVerb}request failed: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
\end{DoxyVerb}


The idea here is that the lowest level (Node\textquotesingle{}s \char`\"{}fs.\+stat\char`\"{} function) generates an arbitrary error, and each higher level (request handler and stat callback) creates a new V\+Error that annotates the previous error with what it was doing, so that the result is a clear message explaining what failed at each level.

This plays nicely with extsprintf\textquotesingle{}s \char`\"{}\%r\char`\"{} specifier, which prints out a Java-\/style stacktrace with the whole chain of exceptions\+: \begin{DoxyVerb}EXCEPTION: VError: request failed: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
    at /Users/dap/work/node-verror/examples/levels.js:21:21
    at /Users/dap/work/node-verror/examples/levels.js:9:12
    at Object.oncomplete (fs.js:297:15)
Caused by: EXCEPTION: VError: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
    at /Users/dap/work/node-verror/examples/levels.js:9:21
    at Object.oncomplete (fs.js:297:15)
Caused by: EXCEPTION: Error: Error: ENOENT, stat '/nonexistent'
\end{DoxyVerb}


\subsection*{W\+Error for wrapped errors}

Sometimes you don\textquotesingle{}t want an Error\textquotesingle{}s \char`\"{}message\char`\"{} field to include the details of all of the low-\/level errors, but you still want to be able to get at them programmatically. For example, in an H\+T\+TP server, you probably don\textquotesingle{}t want to spew all of the low-\/level errors back to the client, but you do want to include them in the audit log entry for the request. In that case, you can use a W\+Error, which is created exactly like V\+Error (and also supports both printf-\/style arguments and an optional cause), but the resulting \char`\"{}message\char`\"{} only contains the top-\/level error. It\textquotesingle{}s also more verbose, including the class associated with each error in the cause chain. Using the same example above, but replacing the V\+Error in handle\+Request with W\+Error, we get this output\+: \begin{DoxyVerb}request failed
\end{DoxyVerb}


That\textquotesingle{}s what we wanted -- just a high-\/level summary for the client. But we can get the object\textquotesingle{}s to\+String() for the full details\+: \begin{DoxyVerb}WError: request failed; caused by WError: failed to check "/nonexistent";
caused by Error: ENOENT, stat '/nonexistent'
\end{DoxyVerb}


\section*{Contributing}

Contributions welcome. Code should be \char`\"{}make check\char`\"{} clean. To run \char`\"{}make check\char`\"{}, you\textquotesingle{}ll need these tools\+:


\begin{DoxyItemize}
\item \href{https://github.com/davepacheco/jsstyle}{\tt https\+://github.\+com/davepacheco/jsstyle}
\item \href{https://github.com/davepacheco/javascriptlint}{\tt https\+://github.\+com/davepacheco/javascriptlint}
\end{DoxyItemize}

If you\textquotesingle{}re changing something non-\/trivial or user-\/facing, you may want to submit an issue first. 