Yet another parser for command line options.

\href{https://www.npmjs.org/package/coa}{\tt } \href{https://travis-ci.org/veged/coa}{\tt } \href{https://ci.appveyor.com/project/zxqfox/coa}{\tt } \href{https://coveralls.io/r/veged/coa}{\tt } \href{https://david-dm.org/veged/coa}{\tt }

\subsection*{What is it?}

C\+OA is a parser for command line options that aim to get maximum profit from formalization your program A\+PI. Once you write definition in terms of commands, options and arguments you automaticaly get\+:


\begin{DoxyItemize}
\item Command line help text
\item Program A\+PI for use C\+O\+A-\/based programs as modules
\item Shell completion
\end{DoxyItemize}

\subsubsection*{Other features}


\begin{DoxyItemize}
\item Rich types for options and arguments, such as arrays, boolean flags and required
\item Commands can be async throught using promising (powered by \href{https://github.com/kriskowal/q}{\tt Q})
\item Easy submoduling some existing commands to new top-\/level one
\item Combined validation and complex parsing of values
\end{DoxyItemize}

\subsubsection*{T\+O\+DO}


\begin{DoxyItemize}
\item Localization
\item Shell-\/mode
\item Configs
\begin{DoxyItemize}
\item Aliases
\item Defaults
\end{DoxyItemize}
\end{DoxyItemize}

\subsection*{Examples}


\begin{DoxyCode}
require('coa').Cmd() // main (top level) command declaration
    .name(process.argv[1]) // set top level command name from program name
    .title('My awesome command line util') // title for use in text messages
    .helpful() // make command "helpful", i.e. options -h --help with usage message
    .opt() // add some option
        .name('version') // name for use in API
        .title('Version') // title for use in text messages
        .short('v') // short key: -v
        .long('version') // long key: --version
        .flag() // for options without value
        .act(function(opts) \{ // add action for option
            // return message as result of action
            return JSON.parse(require('fs').readFileSync(\_\_dirname + '/package.json'))
                .version;
        \})
        .end() // end option chain and return to main command
    .cmd().name('subcommand').apply(require('./subcommand').COA).end() // load subcommand from module
    .cmd() // inplace subcommand declaration
        .name('othercommand').title('Awesome other subcommand').helpful()
        .opt()
            .name('input').title('input file, required')
            .short('i').long('input')
            .val(function(v) \{ // validator function, also for translate simple values
                return require('fs').createReadStream(v) \})
            .req() // make option required
            .end() // end option chain and return to command
        .end() // end subcommand chain and return to parent command
    .run(process.argv.slice(2)); // parse and run on process.argv
\end{DoxyCode}



\begin{DoxyCode}
// subcommand.js
exports.COA = function() \{
    this
        .title('Awesome subcommand').helpful()
        .opt()
            .name('output').title('output file')
            .short('o').long('output')
            .output() // use default preset for "output" option declaration
            .end()
\};
\end{DoxyCode}


\subsection*{A\+PI reference}

\subsubsection*{Cmd}

Command is a top level entity. Commands may have options and arguments.

\paragraph*{Cmd.\+api}

Returns object containing all its subcommands as methods to use from other programs.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
$\ast$\{Object\}$\ast$
\end{DoxyReturn}
\paragraph*{Cmd.\+name}}

{\bfseries  Set a canonical command identifier to be used anywhere in the A\+PI.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape String} {\ttfamily \+\_\+name} command name~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+title}}

{\bfseries  Set a long description for command to be used anywhere in text messages.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape String} {\ttfamily \+\_\+title} command title~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+cmd}}

{\bfseries  Create new or add existing subcommand for current command.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape C\+O\+A.\+Cmd} {\ttfamily \mbox{[}cmd\mbox{]}} existing command instance~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} new or added subcommand instance
\end{DoxyReturn}
\paragraph*{Cmd.\+opt}}

{\bfseries  Create option for current command.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape C\+O\+A.\+Opt} {\ttfamily new} option instance
\end{DoxyReturn}
\paragraph*{Cmd.\+arg}}}

{\bfseries {\bfseries  Create argument for current command.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape C\+O\+A.\+Opt} {\ttfamily new} argument instance
\end{DoxyReturn}
\paragraph*{Cmd.\+act}}}}

{\bfseries {\bfseries {\bfseries  Add (or set) action for current command.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape Function} {\ttfamily act} action function, invoked in the context of command instance and has the parameters\+:~\newline

\begin{DoxyItemize}
\item {\itshape Object} {\ttfamily opts} parsed options~\newline

\item {\itshape Array} {\ttfamily args} parsed arguments~\newline

\item {\itshape Object} {\ttfamily res} actions result accumulator~\newline
 It can return rejected promise by Cmd.\+reject (in case of error) or any other value treated as result.~\newline
 $\ast$$\ast$
\end{DoxyItemize}\\
\hline
{\em $\ast$$\ast$} & $\ast$\{Boolean\}$\ast$ \mbox{[}force=false\mbox{]} flag for set action instead add to existings~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+apply}}}}

{\bfseries {\bfseries {\bfseries  Apply function with arguments in context of command instance.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape Function} {\ttfamily fn}~\newline
 $\ast$$\ast$\\
\hline
{\em $\ast$$\ast$} & {\itshape Array} {\ttfamily args}~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+comp}}}}

{\bfseries {\bfseries {\bfseries  Set custom additional completion for current command.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape Function} {\ttfamily fn} completion generation function, invoked in the context of command instance. Accepts parameters\+:~\newline

\begin{DoxyItemize}
\item {\itshape Object} {\ttfamily opts} completion options~\newline
 It can return promise or any other value treated as result.~\newline
 {\bfseries }
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+helpful}}}}

{\bfseries {\bfseries {\bfseries  Make command \char`\"{}helpful\char`\"{}, i.\+e. add -\/h --help flags for print usage.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+completable}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries  Adds shell completion to command, adds \char`\"{}completion\char`\"{} subcommand, that makes all the magic.~\newline
 Must be called only on root command.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+usage}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Build full usage text for current command instance.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape String} {\ttfamily usage} text
\end{DoxyReturn}
\paragraph*{Cmd.\+run}}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Parse arguments from simple format like Node\+JS process.\+argv and run ahead current program, i.\+e. call process.\+exit when all actions done.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape Array} {\ttfamily argv}~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape C\+O\+A.\+Cmd} {\ttfamily this} instance (for chainability)
\end{DoxyReturn}
\paragraph*{Cmd.\+invoke}}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Invoke specified (or current) command using provided options and arguments.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape String$\vert$\+Array} {\ttfamily cmds} subcommand to invoke (optional)~\newline
 $\ast$$\ast$\\
\hline
{\em $\ast$$\ast$} & {\itshape Object} {\ttfamily opts} command options (optional)~\newline
 $\ast$$\ast$\\
\hline
{\em $\ast$$\ast$} & {\itshape Object} {\ttfamily args} command arguments (optional)~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape Q.\+Promise}
\end{DoxyReturn}
\paragraph*{Cmd.\+reject}}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Return reject of actions results promise.~\newline
 Use in .act() for return with error.~\newline
 $\ast$$\ast$
\begin{DoxyParams}{参数}
{\em $\ast$$\ast$} & {\itshape Object} {\ttfamily reason} reject reason~\newline
 You can customize to\+String() method and exit\+Code property of reason object.~\newline
 {\bfseries }\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
{\bfseries } {\itshape Q.\+promise} rejected promise
\end{DoxyReturn}
\paragraph*{Cmd.\+end}}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Finish chain for current subcommand and return parent command instance.~\newline
 {\bfseries \begin{DoxyReturn}{返回}
{\itshape C\+O\+A.\+Cmd} {\ttfamily parent} command
\end{DoxyReturn}
\subsubsection*{Opt}}}}}}}}

{\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries {\bfseries  Option is a named entity. Options may have short and long keys for use from command line.~\newline
 $\ast$$\ast$ }}}}}}}