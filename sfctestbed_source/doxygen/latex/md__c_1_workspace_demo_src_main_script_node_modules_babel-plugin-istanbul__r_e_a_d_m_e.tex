\href{https://greenkeeper.io/}{\tt } \href{https://travis-ci.org/istanbuljs/babel-plugin-istanbul}{\tt } \href{https://coveralls.io/github/istanbuljs/babel-plugin-istanbul?branch=master}{\tt } \href{https://conventionalcommits.org}{\tt }

A Babel plugin that instruments your code with Istanbul coverage. It can instantly be used with \href{https://github.com/karma-runner/karma-coverage}{\tt karma-\/coverage} and mocha on Node.\+js (through \href{https://github.com/bcoe/nyc}{\tt nyc}).

{\bfseries Note\+:} This plugin does not generate any report or save any data to any file; it only adds instrumenting code to your Java\+Script source code. To integrate with testing tools, please see the \href{#integrations}{\tt Integrations} section.

\subsection*{Usage}

Install it\+:


\begin{DoxyCode}
npm install --save-dev babel-plugin-istanbul
\end{DoxyCode}


Add it to {\ttfamily .babelrc} in test mode\+:


\begin{DoxyCode}
\{
  "env": \{
    "test": \{
      "plugins": [ "istanbul" ]
    \}
  \}
\}
\end{DoxyCode}


Optionally, use \href{https://www.npmjs.com/package/cross-env}{\tt cross-\/env} to set {\ttfamily N\+O\+D\+E\+\_\+\+E\+NV=test}\+:


\begin{DoxyCode}
\{
  "scripts": \{
    "test": "cross-env NODE\_ENV=test nyc --reporter=lcov --reporter=text mocha test/*.js"
  \}
\}
\end{DoxyCode}


\subsection*{Integrations}

\subsubsection*{karma}

It {\itshape just works} with Karma. First, make sure that the code is already transpiled by Babel (either using {\ttfamily karma-\/babel-\/preprocessor}, {\ttfamily karma-\/webpack}, or {\ttfamily karma-\/browserify}). Then, simply set up \href{https://github.com/karma-runner/karma-coverage}{\tt karma-\/coverage} according to the docs, but {\bfseries donâ€™t add the {\ttfamily coverage} preprocessor.} This plugin has already instrumented your code, and Karma should pick it up automatically.

It has been tested with \href{https://codecov.io/github/bemusic/bemuse}{\tt bemusic/bemuse} project, which contains $\sim$2400 statements.

\subsubsection*{mocha on node.\+js (through nyc)}

Configure Mocha to transpile Java\+Script code using Babel, then you can run your tests with \href{https://github.com/bcoe/nyc}{\tt {\ttfamily nyc}}, which will collect all the coverage report.

babel-\/plugin-\/istanbul respects the {\ttfamily include}/{\ttfamily exclude} configuration options from nyc, but you also need to {\bfseries configure N\+YC not to instrument your code} by adding these settings in your {\ttfamily package.\+json}\+:


\begin{DoxyCode}
"nyc": \{
  "sourceMap": false,
  "instrument": false
\},
\end{DoxyCode}


\subsection*{Ignoring files}

You don\textquotesingle{}t want to cover your test files as this will skew your coverage results. You can configure this by providing plugin options matching nyc\textquotesingle{}s \href{https://github.com/bcoe/nyc#excluding-files}{\tt {\ttfamily exclude}/{\ttfamily include} rules}\+:


\begin{DoxyCode}
\{
  "env": \{
    "test": \{
      "plugins": [
        ["istanbul", \{
          "exclude": [
            "**/*.spec.js"
          ]
        \}]
      ]
    \}
  \}
\}
\end{DoxyCode}


If you don\textquotesingle{}t provide options in your Babel config, the plugin will look for {\ttfamily exclude}/{\ttfamily include} config under an {\ttfamily \char`\"{}nyc\char`\"{}} key in {\ttfamily package.\+json}.

You can also use \href{https://github.com/gotwarlost/istanbul/blob/master/ignoring-code-for-coverage.md#ignoring-code-for-coverage-purposes}{\tt istanbul\textquotesingle{}s ignore hints} to specify specific lines of code to skip instrumenting.

\subsection*{Source Maps}

By default, this plugin will pick up inline source maps and attach them to the instrumented code such that code coverage can be remapped back to the original source, even for multi-\/step build processes. This can be memory intensive. Set {\ttfamily use\+Inline\+Source\+Maps} to prevent this behavior.


\begin{DoxyCode}
\{
  "env": \{
    "test": \{
      "plugins": [
        ["istanbul", \{
          "useInlineSourceMaps": false
        \}]
      ]
    \}
  \}
\}
\end{DoxyCode}


If you\textquotesingle{}re instrumenting code programatically, you can pass a source map explicitly. 
\begin{DoxyCode}
import babelPluginIstanbul from 'babel-plugin-istanbul';

function instrument(sourceCode, sourceMap, fileName) \{
  return babel.transform(sourceCode, \{
    filename,
    plugins: [
      [babelPluginIstanbul, \{
        inputSourceMap: sourceMap
      \}]
    ]
  \})
\}
\end{DoxyCode}


\subsection*{Credit where credit is due}

The approach used in {\ttfamily babel-\/plugin-\/istanbul} was inspired by \href{https://github.com/dtinth}{\tt Thai Pangsakulyanont}\textquotesingle{}s original library \href{https://github.com/dtinth/babel-plugin-__coverage__}{\tt {\ttfamily babel-\/plugin-\/\+\_\+\+\_\+coverage\+\_\+\+\_\+}}. 