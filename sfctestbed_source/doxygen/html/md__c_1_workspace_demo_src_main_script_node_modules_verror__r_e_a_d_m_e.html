<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>demo: verror: richer JavaScript errors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">demo
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Vfunc Spring Boot项目概要</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">verror: richer JavaScript errors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module provides two classes: VError, for accretive errors, and WError, for wrapping errors. Both support printf-style error messages using extsprintf.</p>
<h2>Printf-style errors</h2>
<p>At the most basic level, VError is just like JavaScript's Error class, but with printf-style arguments: </p><pre class="fragment">var verror = require('verror');

var opname = 'read';
var err = new verror.VError('"%s" operation failed', opname);
console.log(err.message);
console.log(err.stack);
</pre><p>This prints: </p><pre class="fragment">"read" operation failed
"read" operation failed
    at Object.&lt;anonymous&gt; (/Users/dap/node-verror/examples/varargs.js:4:11)
    at Module._compile (module.js:449:26)
    at Object.Module._extensions..js (module.js:467:10)
    at Module.load (module.js:356:32)
    at Function.Module._load (module.js:312:12)
    at Module.runMain (module.js:492:10)
    at process.startup.processNextTick.process._tickCallback (node.js:244:9)
</pre><h2>VError for accretive error messages</h2>
<p>More interestingly, you can use VError to build up an error describing what happened at various levels in the stack. For example, suppose you have a request handler that stats a file and fails if it doesn't exist: </p><pre class="fragment">var fs = require('fs');
var verror = require('verror');

function checkFile(filename, callback) {
    fs.stat(filename, function (err) {
        if (err)
    /* Annotate the "stat" error with what we were doing. */
        return (callback(new verror.VError(err,
        'failed to check "%s"', filename)));

    /* ... */
    });
}

function handleRequest(filename, callback) {
    checkFile('/nonexistent', function (err) {
        if (err) {
            /* Annotate the "checkFile" error with what we were doing. */
            return (callback(new verror.VError(err, 'request failed')));
        }

        /* ... */
    });
}

handleRequest('/nonexistent', function (err) {
if (err)
    console.log(err.message);
/* ... */
});
</pre><p>Since the file "/nonexistent" doesn't exist, this prints out: </p><pre class="fragment">request failed: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
</pre><p>The idea here is that the lowest level (Node's "fs.stat" function) generates an arbitrary error, and each higher level (request handler and stat callback) creates a new VError that annotates the previous error with what it was doing, so that the result is a clear message explaining what failed at each level.</p>
<p>This plays nicely with extsprintf's "%r" specifier, which prints out a Java-style stacktrace with the whole chain of exceptions: </p><pre class="fragment">EXCEPTION: VError: request failed: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
    at /Users/dap/work/node-verror/examples/levels.js:21:21
    at /Users/dap/work/node-verror/examples/levels.js:9:12
    at Object.oncomplete (fs.js:297:15)
Caused by: EXCEPTION: VError: failed to check "/nonexistent": ENOENT, stat '/nonexistent'
    at /Users/dap/work/node-verror/examples/levels.js:9:21
    at Object.oncomplete (fs.js:297:15)
Caused by: EXCEPTION: Error: Error: ENOENT, stat '/nonexistent'
</pre><h2>WError for wrapped errors</h2>
<p>Sometimes you don't want an Error's "message" field to include the details of all of the low-level errors, but you still want to be able to get at them programmatically. For example, in an HTTP server, you probably don't want to spew all of the low-level errors back to the client, but you do want to include them in the audit log entry for the request. In that case, you can use a WError, which is created exactly like VError (and also supports both printf-style arguments and an optional cause), but the resulting "message" only contains the top-level error. It's also more verbose, including the class associated with each error in the cause chain. Using the same example above, but replacing the VError in handleRequest with WError, we get this output: </p><pre class="fragment">request failed
</pre><p>That's what we wanted &ndash; just a high-level summary for the client. But we can get the object's toString() for the full details: </p><pre class="fragment">WError: request failed; caused by WError: failed to check "/nonexistent";
caused by Error: ENOENT, stat '/nonexistent'
</pre><h1>Contributing</h1>
<p>Contributions welcome. Code should be "make check" clean. To run "make check", you'll need these tools:</p>
<ul>
<li><a href="https://github.com/davepacheco/jsstyle">https://github.com/davepacheco/jsstyle</a></li>
<li><a href="https://github.com/davepacheco/javascriptlint">https://github.com/davepacheco/javascriptlint</a></li>
</ul>
<p>If you're changing something non-trivial or user-facing, you may want to submit an issue first. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
